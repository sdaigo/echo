---
description: デプロイ前のゲートチェックを実行する
---

# デプロイ前チェック

引数: `/pre-deploy [staging|production]`

## 概要

デプロイ前に必須チェックを実行し、全て通過した場合のみデプロイ可能と判定する。

## ステップ1: 環境の判定

- 引数で `staging` / `production` を判定（デフォルト: `staging`）
- `production` の場合、追加チェックを実行する

## ステップ2: 必須チェック（全環境共通）

以下を順に実行し、結果をサマリーに記録する:

### 2-1. テスト

```bash
bunx vitest run
bunx tsc --noEmit
bunx biome check .
```

### 2-2. ビルド

```bash
bun run build
```

ビルドエラーがある場合はここで中断する。

### 2-3. 環境変数チェック

- `.env.example`（または `.env.local.example`）が存在する場合、必要な環境変数を一覧する
- デプロイ先の環境に設定漏れがないかユーザーに確認を促す

### 2-4. セキュリティ監査

`security-reviewer` エージェントを起動し、以下をチェック:

- ハードコードされたシークレットがないか
- `.env` ファイルが `.gitignore` に含まれているか
- 公開すべきでないファイルがコミットされていないか

## ステップ3: 追加チェック（production のみ）

- `a11y-auditor` エージェントを起動し、主要画面のアクセシビリティを確認
- パフォーマンスに影響する `console.log` の残留チェック
- `TODO` / `FIXME` コメントの残留チェック

## ステップ4: 結果サマリー

```
## Pre-Deploy Check: [環境] - [日時]

### 結果: [PASS / FAIL]

| チェック項目 | 結果 |
|:---|:---|
| テスト | OK / NG |
| 型チェック | OK / NG |
| Lint | OK / NG |
| ビルド | OK / NG |
| 環境変数 | OK / 確認必要 |
| セキュリティ | OK / 指摘あり |
| a11y (prodのみ) | OK / 指摘あり |

### 指摘事項
- [指摘があれば記載]
```

- 全て PASS → 「デプロイ可能です」と報告
- NG あり → 「以下を修正してから再実行してください」と報告
